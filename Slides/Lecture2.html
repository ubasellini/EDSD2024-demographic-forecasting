<!DOCTYPE html>
<html lang="en"><head>
<script src="Lecture2_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lecture2_files/libs/quarto-html/tabby.min.js"></script>
<script src="Lecture2_files/libs/quarto-html/popper.min.js"></script>
<script src="Lecture2_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="Lecture2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lecture2_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="Lecture2_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="Lecture2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Ugofilippo Basellini">
  <meta name="dcterms.date" content="2024-03-05">
  <title>Demographic Forecasting</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="Lecture2_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="Lecture2_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="Lecture2_files/libs/revealjs/dist/theme/quarto.css">
  <link href="Lecture2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="Lecture2_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="Lecture2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="Lecture2_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Demographic Forecasting</h1>
  <p class="subtitle"></p><p><em>Lecture 2: Direct extrapolation</em><br>
<em>by time-series methods</em></p><p></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Ugofilippo Basellini 
</div>
<div class="quarto-title-author-email">
<a href="mailto:basellini@demogr.mpg.de">basellini@demogr.mpg.de</a>
</div>
        <p class="quarto-title-affiliation">
            Max Planck Institute for Demographic Research
          </p>
    </div>
</div>

  <p class="date">March 5, 2024</p>
</section>
<section id="course-overview" class="slide level2">
<h2>Course overview</h2>
<div class="fragment semi-fade-out" data-fragment-index="2">
<ul>
<li>Lecture 1: direct extrapolation by (generalized) linear models</li>
</ul>
</div>
<ul>
<li>Lecture 2: direct extrapolation by time-series methods</li>
</ul>
<div class="fragment semi-fade-out" data-fragment-index="2">
<ul>
<li>Lecture 3: parametric approaches</li>
<li>Lecture 4: Lee-Carter method</li>
</ul>
</div>
</section>
<section id="time-series-analysis-intro" class="slide level2 smaller">
<h2>Time-series analysis: intro</h2>
<!-- ::: incremental -->
<ul>
<li>A <em>time-series</em> is a collection of observations made sequentially through time. Let us focus on discrete time series recorded at equal intervals of time</li>
<li>Suppose we have an observed time series <span class="math inline">\(y_1, y_2, \dots, y_T\)</span> and we wish to forecast future values such as <span class="math inline">\(y_{T+h}\)</span>. The integer <span class="math inline">\(h\)</span> is called <em>forecasting horizon</em>, and we denote by <span class="math inline">\(\hat{y}_{T+h}\)</span> the forecast made at time <span class="math inline">\(T\)</span> for <span class="math inline">\(h\)</span> steps ahead</li>
<li>Forecasting methods may be broadly identified into three types:
<ul>
<li><em>Judgemental forecasts</em> : based on subjective judgement and intuition</li>
<li><em>Univariate methods</em> : forecasts depend on present and past values of a single series</li>
<li><em>Multivariate methods</em> : forecasts depend, at least partly, on values of one or more additional variables (predictors)</li>
</ul></li>
</ul>
<p><span class="math inline">\(\Rightarrow\)</span> here univariate time-series methods <!-- ::: --></p>
</section>
<section id="descriptive-techniques" class="slide level2">
<h2>Descriptive techniques</h2>
<!-- ::: incremental -->
<ul>
<li>In order to <em>forecast</em>, description and modelling of data is a prerequisite</li>
<li>Always start from plotting your data!</li>
<li>This can help to identify two main sources of variation in many time series: i) trend, and ii) seasonal variation<br>
</li>
<li>These variations are typically removed before time-series modelling via differencing <span class="math inline">\(\Rightarrow\)</span> helps to stabilize the <strong>mean</strong><br>
</li>
<li>The time plot may also help to decide whether a variable needs to be transformed <span class="math inline">\(\Rightarrow\)</span> helps to stabilize the <strong>variance</strong> (e.g.&nbsp;log-transformation) <!-- :::  --></li>
</ul>
</section>
<section id="stationary-stochastic-processes" class="slide level2 smaller">
<h2>Stationary stochastic processes</h2>
<ul>
<li>A <em>stochastic</em> time series is one where future values can only partly be determined by past values</li>
<li>A process is defined stationary_ if its properties do not change through time</li>
<li>More formally, let <span class="math inline">\(y_t\)</span> be the realization of the underlying random variable <span class="math inline">\(Y_t\)</span>, and the observed time-series <span class="math inline">\(\boldsymbol{y}=\left[y_1, y_2, \dots, y_T \right]\)</span> be a realization of the stochastic process</li>
<li>A stochastic process is second-order stationary if its first and second moments are finite and do not change over time, i.e.:</li>
</ul>
<span class="math display">\[\begin{align*}
\mathbb{E}\left[Y_t\right] &amp;= \mu  \\
\mathrm{COV}\left[Y_t, Y_{t+k}\right] &amp;= \mathbb{E}\left[\left(Y_t - \mu\right) \left( Y_{t+k} - \mu\right)\right] = \gamma_k
\end{align*}\]</span>
<p>for all <span class="math inline">\(t\)</span> and for <span class="math inline">\(k=0,1,2,\dots\)</span> (note, for <span class="math inline">\(k=0\)</span>, <span class="math inline">\(\gamma_0 = \sigma^2\)</span>)</p>
<ul>
<li>In simpler words, a stationary series has constant mean, constant variance and no predictable patterns in the long-term</li>
</ul>
</section>
<section id="the-acf" class="slide level2 smaller">
<h2>The ACF</h2>
<ul>
<li>The set of coefficients <span class="math inline">\(\gamma_k\)</span> constitutes the autocovariance function, which is standardized to give the the autocorrelation function (ACF) <span class="math inline">\(\; \rho_k = \gamma_k / \gamma_0\)</span></li>
<li>The sample autocovariance coefficient at lag <span class="math inline">\(k\)</span> is given by<br>
<span class="math display">\[
  c_k = \sum_{t=1}^{T-k} \left(y_t - \bar{y}\right) \left(y_{t+k} - \bar{y}\right) / T
\]</span> for <span class="math inline">\(k=0,1,2,\dots\)</span>,</li>
<li>The sample autocorrelation coefficient at lag <span class="math inline">\(k\)</span> is computed as <span class="math inline">\(r_k=c_k/c_0\)</span></li>
<li><span class="math inline">\(r_k\)</span> is an estimate of the theoretical <span class="math inline">\(\rho_k\)</span></li>
</ul>
</section>
<section id="the-correlogram-partial-acf" class="slide level2">
<h2>The correlogram &amp; partial ACF</h2>
<ul>
<li>The <strong>correlogram</strong> is the graph of <span class="math inline">\(r_k\)</span> against <span class="math inline">\(k\)</span></li>
<li>Plotting the correlogram is very useful:
<ul>
<li>the ACF of non-stationary data decreases slowly, with <span class="math inline">\(r_1\)</span> often large and positive (see example in next slide)</li>
<li>the ACF of stationary data drops to zero relatively quickly</li>
<li>useful to identify orders of AR(<span class="math inline">\(p\)</span>) and MA(<span class="math inline">\(q\)</span>) models</li>
</ul></li>
<li>The <strong>partial</strong> ACF (PACF) measures the excess correlation at lag <span class="math inline">\(k\)</span> which has not already been accounted for by autocorrelations at lower lags</li>
</ul>
</section>
<section id="non-stationary-ts-an-example" class="slide level2 smaller">
<h2>Non-stationary TS: an example</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-1-1.png" width="960" class="r-stretch"><p>Note: i) non-contant mean, and ii) sample correlogram decreases slowly, with <span class="math inline">\(r_1\)</span> large and positive (Source: S&amp;P data for 90 trading days from March 16, 1999, Chatfield (2000))</p>
<div class="footer">

</div>
</section>
<section id="differencing" class="slide level2 smaller">
<h2>Differencing</h2>
<ul>
<li>Powerful tool to stabilize the mean and obtain stationary time-series
<ul>
<li>First-order differencing: <span class="math inline">\(y'_t=y_t-y_{t-1}\)</span>, <span class="math inline">\(y'_t\)</span> is the <em>change</em> between observations of <span class="math inline">\(y_t\)</span> (composed by <span class="math inline">\(T-1\)</span> values)</li>
<li>If <span class="math inline">\(y'_t\)</span> still non-stationary, second-order differencing: <span class="math inline">\(y''_t=y'_t-y'_{t-1}=y_t-2y_{t-1}+y_t-2\)</span> (composed by <span class="math inline">\(T-2\)</span> values)</li>
<li>Almost never necessary to go beyond <span class="math inline">\(y''_t\)</span> </li>
</ul></li>
<li>For seasonal data, seasonal differencing: <span class="math inline">\(y'_t=y_t-y_{t-m}\)</span>, where <span class="math inline">\(m\)</span> is the number of seasons, <span class="math inline">\(y'_t\)</span> is the change between one year to the next </li>
<li>In addition to correlogram, two main tests for determining the required order of differencing:
<ul>
<li>Augmented Dickey Fuller test: <span class="math inline">\(H_0\)</span> data are non-stationary and non-seasonal</li>
<li>Kwiatkowski-Phillips-Schmidt-Shin (KPSS) test : <span class="math inline">\(H_0\)</span> data are stationary and non-seasonal</li>
</ul></li>
</ul>
</section>
<section id="differencing-in-practice" class="slide level2 smaller">
<h2>Differencing in practice</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-2-1.png" width="960" class="r-stretch"><p>Note: i) approx. constant mean and variance, no predictable patterns; ii) ACF drops to zero quickly, tiny value of KPSS test-statistics (cannot reject <span class="math inline">\(H_0\)</span>) <span class="math inline">\(\, \Rightarrow\)</span> stationary time-series</p>
<div class="footer">

</div>
</section>
<section id="purely-random-process-white-noise" class="slide level2">
<h2>Purely random process (white noise)</h2>
<ul>
<li>A sequence of uncorrelated, identically distributed random variables <span class="math inline">\(Z_t\)</span> with zero mean and constant variance <span class="math inline">\(\sigma^2_z\)</span></li>
<li>A stationary process with ACF equal to: <span class="math display">\[
  \rho_k = \left\{ \begin{array}{cc}
      1  &amp;k = 0 \\
      0  &amp;k\neq0
  \end{array} \right.
\]</span></li>
<li>Often used to model the random disturbances in more complicated processes</li>
</ul>
</section>
<section id="purely-random-process-an-example" class="slide level2 smaller">
<h2>Purely random process: an example</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-3-1.png" width="960" class="r-stretch"><p>Simulated time series of purely random process (note how it mimicks the differenced TS and correlogram of S&amp;P)</p>
<div class="footer">

</div>
</section>
<section id="random-walk-model" class="slide level2 smaller">
<h2>Random walk model</h2>
<ul>
<li>Random walk models are widely used for non-stationary data (e.g.~economic and financial data):</li>
</ul>
<p><span class="math display">\[ Y_t = Y_{t-1} + Z_t \]</span></p>
<p>where <span class="math inline">\(Z_t\)</span> is a purely random process</p>
<ul>
<li><p>Random walk is non-stationary (variance increases through time), but first-order differences (purely random process) is stationary</p></li>
<li><p>Typical features:</p>
<ul>
<li>sudden and unpredictable changes of direction</li>
<li>long periods of apparent trends up/down</li>
</ul></li>
<li><p>Forecasts for the random walk model are simply given by the value of the last observation (i.e.~naïve forecast): <span class="math inline">\(\, \hat{y}_{T+h|T} = y_T\)</span></p></li>
</ul>
</section>
<section id="random-walk-process-an-example" class="slide level2 smaller">
<h2>Random walk process: an example</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-4-1.png" width="960" class="r-stretch"><p>Simulated time-series of a random walk process. Note the non-constant mean and the ACF slowly decreasing (indicating non-stationarity)</p>
<div class="footer">

</div>
</section>
<section id="random-walk-with-drift-model" class="slide level2 smaller">
<h2>Random walk with drift model</h2>
<ul>
<li><p>A closely related model that allows first differences to have non-zero mean is the <strong>random walk with drift</strong> (RWD): <span class="math display">\[ Y_t = c + Y_{t-1} + Z_t \]</span> where <span class="math inline">\(Z_t\)</span> is a purely random process, and <span class="math inline">\(c\)</span> is a constant. If <span class="math inline">\(c&gt;0\)</span> (<span class="math inline">\(c&lt;0\)</span>), <span class="math inline">\(y_t\)</span> will tend to drift upwards (downwards)</p></li>
<li><p>The estimate of the drift <span class="math inline">\(c\)</span> is given by the average of the changes between consecutive observations: <span class="math display">\[ c= \frac{1}{T-1}\sum_{t=2}^{T}\left(y_t - y_{t-1}\right) = \frac{y_T - y_1}{T-1} \]</span></p></li>
<li><p>Forecasts for the random walk model with drift are given by <span class="math inline">\(\,\hat{y}_{T+h|T} = y_T + c\,h\)</span> <span class="math inline">\(\, \Rightarrow\)</span> equivalent to drawing a line between the first and last observations, and extrapolating it into the future</p></li>
</ul>
</section>
<section id="rwd-process-an-example" class="slide level2 smaller">
<h2>RWD process: an example</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-5-1.png" width="960" class="r-stretch"><p>Simulated time-series of a random walk process with drift. Note the non-constant mean and the ACF slowly decreasing (indicating non-stationarity)</p>
<div class="footer">

</div>
</section>
<section id="exercise" class="slide level2 smaller">
<h2>Exercise</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<p>Load the <code>TimeSeries.Rdata</code> data in <code>R</code>, and consider the first 200 trading days (i.e.&nbsp;the first 200 observations) from January 1st, 1990. Plot the data and correlogram, and decide whether the time series is stationary. Then (after possibly appropriate transformations) fit two models :</p>
<ul>
<li>a RW model (without drift)</li>
<li>a RWD model</li>
</ul>
<p>In both cases, plot forecasts for the next 50 trading days, and compare the two forecasts against the observed data.</p>
</div>
</div>
</div>
<p>Hints:</p>
<ol type="1">
<li><p>The correlogram is given by the <code>acf</code> function (automatically loaded in <code>R</code>)</p></li>
<li><p>To fit the RW models, use the package <code>forecast</code> and the function `Arima(y = .,order = c(0, 1, 0), include.drift = .) [we will shortly see that the RW model is an ARIMA(0,1,0) model]</p></li>
<li><p>Use the command <code>forecast(object=., h=.)</code> to produce forecasts</p></li>
</ol>
</section>
<section id="one-possible-solution" class="slide level2 smaller">
<h2>One possible solution</h2>
<!-- ``` r -->
<!-- ## cleaning the workspace -->
<!-- rm(list=ls(all=TRUE)) -->
<!-- ## packages -->
<!-- library(tidyverse) -->
<!-- library(forecast) -->
<!-- ## loading the data -->
<!-- setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) -->
<!-- load("data/TimeSeries.Rdata") -->
<!-- ## subset the data -->
<!-- my.df <- sp500.data %>% filter(Date>="1990-01-01") -->
<!-- ## extract -->
<!-- y.all <- my.df %>% select(SP500) %>% slice(1:250) %>% pull() -->
<!-- t.all <- my.df %>% select(Date) %>% slice(1:250) %>% pull() -->
<!-- y <- my.df %>% select(SP500) %>% slice(1:200) %>% pull() -->
<!-- t <- my.df %>% select(Date) %>% slice(1:200) %>% pull() -->
<!-- n <- length(y); n.all <- length(y.all) -->
<!-- tF <- t.all[!t.all%in%t] -->
<!-- nF <- h <- length(tF) -->
<!-- ## plotting -->
<!-- par(mfrow=c(1,2)) -->
<!-- plot(t,y,t="l");acf(y) -->
<!-- par(mfrow=c(1,1)) -->
<!-- ## differencing y -->
<!-- y.diff <- diff(y) -->
<!-- ## plotting -->
<!-- par(mfrow=c(1,2)) -->
<!-- plot(t[-1],y.diff,t="l");acf(y.diff) -->
<!-- par(mfrow=c(1,1)) -->
<!-- ## modelling (two RW models) -->
<!-- mod1 <- Arima(y,order=c(0,1,0),include.drift = F) -->
<!-- mod2 <- Arima(y,order=c(0,1,0),include.drift = T) -->
<!-- ## checking the drift estimate -->
<!-- mod2;(y[n]-y[1])/(n-1) -->
<!-- ## forecast -->
<!-- y.fore1 <- forecast(mod1,h=h) -->
<!-- y.fore2 <- forecast(mod2,h=h) -->
<!-- ## plotting -->
<!-- plot(t,y,t="l",xlim=range(t.all),ylim=range(y,y.fore2$lower[,1]),lwd=2) -->
<!-- abline(v=t[n],lty=2) -->
<!-- points(tF,y.all[t.all%in%tF],cex=0.8) -->
<!-- ## adding forecasts (80%PI and median) -->
<!-- lines(tF,y.fore1$upper[,1],col=2,lwd=2,lty=2) -->
<!-- lines(tF,y.fore1$lower[,1],col=2,lwd=2,lty=2) -->
<!-- lines(tF,y.fore2$upper[,1],col=4,lwd=2,lty=2) -->
<!-- lines(tF,y.fore2$lower[,1],col=4,lwd=2,lty=2) -->
<!-- lines(tF,y.fore1$mean,col=2,lwd=2) -->
<!-- lines(tF,y.fore2$mean,col=4,lwd=2) -->
<!-- legend("bottomleft",c("RW","RW w drift"),col=c(2,4),lwd=2,title = "Forecast:") -->
<!-- ``` -->
</section>
<section id="rw-models" class="slide level2">
<h2>RW models</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section>
<section id="autoregressive-processes" class="slide level2 smaller">
<h2>Autoregressive processes</h2>
<ul>
<li>A process <span class="math inline">\(Y_t\)</span> is autoregressive of order <span class="math inline">\(p\)</span> (denoted AR(<span class="math inline">\(p\)</span>)) if</li>
</ul>
<p><span class="math display">\[ Y_t = c + \phi_1 Y_{t-1} + \phi_2 Y_{t-2} + \dots + \phi_p Y_{t-p} + Z_t\]</span> where <span class="math inline">\(Z_t\)</span> is a purely random process and <span class="math inline">\(c\)</span> is a constant</p>
<ul>
<li>A multiple regression with lagged values of <span class="math inline">\(Y_t\)</span> as predictors</li>
<li>Simplest example: first-order case (AR(1)), where <span class="math inline">\(Y_t = c + \phi Y_{t-1} + Z_t\)</span>
<ul>
<li>if <span class="math inline">\(c=0\)</span> and <span class="math inline">\(\phi=1\)</span>, then random walk</li>
<li>if <span class="math inline">\(c\neq0\)</span> and <span class="math inline">\(\phi=1\)</span>, then random walk with drift</li>
<li>if <span class="math inline">\(|\phi|&gt;1\)</span>, then the series is explosive and non-stationary</li>
<li>if <span class="math inline">\(|\phi|&lt;1\)</span>, then the process is stationary, with ACF given by <span class="math inline">\(\rho_k=\phi^k\)</span> for <span class="math inline">\(k=0,1,2,\dots\)</span> (<span class="math inline">\(\Rightarrow\)</span> the ACF decreases exponentially)</li>
</ul></li>
<li>An useful property of an AR(<span class="math inline">\(p\)</span>) process is that the <em>partial</em> ACF is zero at all lags greater than <span class="math inline">\(p\)</span> <span class="math inline">\(\, \Rightarrow\)</span> useful for model selection</li>
</ul>
<div class="footer">

</div>
</section>
<section id="ar1-process-an-example" class="slide level2 smaller">
<h2>AR(1) process: an example</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"><p>Simulated time-series of an AR(1) process <span class="math inline">\(y_t=0.6y_{t-1}+z_t\)</span>. Note the ACF dies out in a sine-wave manner, PACF has all zero spikes beyond the 1st spike</p>
<div class="footer">

</div>
</section>
<section id="moving-average-processes" class="slide level2 smaller">
<h2>Moving average processes</h2>
<ul>
<li>A process <span class="math inline">\(Y_t\)</span> is moving average of order <span class="math inline">\(q\)</span> (denoted MA(<span class="math inline">\(q\)</span>)) if</li>
</ul>
<p><span class="math display">\[ Y_t = c + Z_t + \theta_1 Z_{t-1} + \theta_2 Z_{t-2} + \dots + \theta_q Z_{t-q}\]</span> where <span class="math inline">\(Z_t\)</span> is a purely random process and <span class="math inline">\(c\)</span> is a constant</p>
<ul>
<li><p>A multiple regression with past errors as predictors; finite-order MA process is stationary for any values of <span class="math inline">\(\boldsymbol{\theta}\)</span></p></li>
<li><p>Simplest example: first-order case (MA(1)), where <span class="math inline">\(Y_t = Z_t + \theta Z_{t-1}\)</span>, is stationary <span class="math inline">\(\forall \theta\)</span> with ACF given by: <span class="math display">\[ \rho_k = \left\{ \begin{array}{cc}
              1  &amp;k = 0 \\
              \theta / \left(1+\theta^2\right)  &amp;k = 1 \\
              0  &amp;k&gt;1
          \end{array} \right. \]</span></p></li>
<li><p>An useful property of an MA(<span class="math inline">\(q\)</span>) process is that the ACF is zero at all lags greater than <span class="math inline">\(q\)</span> <span class="math inline">\(\, \Rightarrow\)</span> useful for model selection</p></li>
</ul>
<div class="footer">

</div>
</section>
<section id="ma1-process-an-example" class="slide level2 smaller">
<h2>MA(1) process: an example</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"><p>Simulated time-series of an MA(1) process <span class="math inline">\(y_t=z_t+0.45z_{t-1}\)</span>. Note the ACF is zero at all lags greater than 1, while the PACF dies out in a sine-wave manner</p>
<div class="footer">

</div>
</section>
<section id="arma-arima-processes" class="slide level2 smaller">
<h2>ARMA &amp; ARIMA processes</h2>
<p>Putting together AR(<span class="math inline">\(p\)</span>) and MA(<span class="math inline">\(q\)</span>), a process <span class="math inline">\(Y_t\)</span> is autoregressive moving average (denoted ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>)) if <span class="math display">\[ Y_t = c + \phi_1 Y_{t-1} + \dots + \phi_p Y_{t-p} + Z_t + \theta_1 Z_{t-1} + \dots + \theta_q Z_{t-q}\]</span> where <span class="math inline">\(Z_t\)</span> is a purely random process and <span class="math inline">\(c\)</span> is a constant</p>
<ul>
<li>Moreover, most time-series are not stationary, and we cannot apply stationary AR, MA or ARMA processes <span class="math inline">\(\, \Rightarrow\)</span> ARIMA(<span class="math inline">\(p,d,q\)</span>) models combine ARMA with <strong>differencing</strong> of order <span class="math inline">\(d\)</span>, employed to make series stationary</li>
<li>Autoregressive Integrated Moving Average (ARIMA(<span class="math inline">\(p,d,q\)</span>)) is a very general class of time-series models:
<ul>
<li>purely random process: ARIMA(0,0,0)</li>
<li>random walk: ARIMA(0,1,0) without constant</li>
<li>random walk with drift: ARIMA(0,1,0) with constant</li>
<li>AR(<span class="math inline">\(p\)</span>): ARIMA(<span class="math inline">\(p\)</span>,0,0); MA(<span class="math inline">\(q\)</span>): ARIMA(0,0,<span class="math inline">\(q\)</span>)</li>
</ul></li>
</ul>
<div class="footer">

</div>
</section>
<section id="modelling-procedure-with-arima" class="slide level2 smaller">
<h2>Modelling procedure with ARIMA</h2>
<ol type="1">
<li>Plot the data and identify unusual observations</li>
<li>If necessary, transform the data to stabilize the variance</li>
<li>If data non-stationary: take first-order differences until data are stationary</li>
<li>Examine ACF/PACF: is an AR(<span class="math inline">\(p\)</span>) or MA(<span class="math inline">\(q\)</span>) model appropriate?</li>
<li>Try chosen model(s) and employ AICc to search for a better one 6 Check residuals of the model <span class="math inline">\(\, \Rightarrow\)</span> they should look like a purely random process</li>
<li>Forecast</li>
</ol>
<p>Interpreting the ACF/PACF can be very challenging, and not suitable for ARMA processes <span class="math inline">\(\Rightarrow\)</span> points 3–5 with <code>auto.arima</code> function from <code>forecast</code> package</p>
</section>
<section id="exercise-1" class="slide level2">
<h2>Exercise</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<p>Now load the <code>FERT.SWE.Rdata</code> dataset, and consider again only data from 1950 onward for women aged 20. Fit and compare forecast up to 2050 of log-fertility rates using three approaches:</p>
<ul>
<li>a GLM for births with exposures as an offset (Day 1)</li>
<li>a RWD model for log-fertility rates</li>
<li>the most suitable ARIMA model (use the <code>auto.arima</code> function) for log-fertility rates</li>
</ul>
</div>
</div>
</div>
</section>
<section id="one-possible-solution-1" class="slide level2 smaller">
<h2>One possible solution</h2>
<!-- ``` r -->
<!-- ## cleaning the workspace -->
<!-- rm(list=ls(all=TRUE)) -->
<!-- ## loading the data -->
<!-- setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) -->
<!-- load("data/FertSWE.Rdata") -->
<!-- ## subset  -->
<!-- my.df <- FERT.SWE %>% filter(Year>=1950, Age == 20) -->
<!-- ## data -->
<!-- x <- my.df$Year -->
<!-- y <- my.df$Births -->
<!-- e <- my.df$Exposures -->
<!-- f <- y/e;  -->
<!-- lf <- log(f) -->
<!-- n <- length(x) -->
<!-- plot(x,lf) -->
<!-- ## forecast horizon -->
<!-- tF <- x[1]:2050 -->
<!-- nF <- length(tF) -->
<!-- xF <- (x[n]+1):2050 -->
<!-- h <- length(xF) -->
<!-- ## 1) fit Poisson glm to births -->
<!-- glm1 <- glm(y~x,offset = log(e),family=poisson()) -->
<!-- ## linear combination of betas -->
<!-- X <- cbind(1,tF) -->
<!-- eta.hat <- X%*%coef(glm1) -->
<!-- ## var-covar matrix -->
<!-- V <- vcov(glm1) -->
<!-- ## computing standard errors -->
<!-- se.eta <- sqrt(diag(X%*%V%*%t(X))) -->
<!-- ## upper and lower 95% CI -->
<!-- eta.hat.low <- eta.hat - 2*se.eta -->
<!-- eta.hat.up <- eta.hat + 2*se.eta -->
<!-- ## 2) Time-series models -->
<!-- mod1 <- Arima(lf,order = c(0,1,0),include.drift = T) -->
<!-- mod2 <- auto.arima(lf) -->
<!-- ## forecast -->
<!-- lf.fore1 <- forecast(mod1,h=h) -->
<!-- lf.fore2 <- forecast(mod2,h=h) -->
<!-- plot(lf.fore1) -->
<!-- plot(lf.fore2) -->
<!-- ## plotting -->
<!-- plot(x,lf,ylim=range(lf,eta.hat.low,lf.fore1$lower,lf.fore2$lower),xlim=range(tF)) -->
<!-- ## GLM -->
<!-- lines(tF,eta.hat,col=4,lwd=2) -->
<!-- lines(tF,eta.hat.low,col=4,lwd=2,lty=2) -->
<!-- lines(tF,eta.hat.up,col=4,lwd=2,lty=2) -->
<!-- ## RWD -->
<!-- lines(x,fitted(mod1),col=2,lwd=2) -->
<!-- lines(xF,lf.fore1$mean,col=2,lwd=2) -->
<!-- lines(xF,lf.fore1$upper[,2],col=2,lwd=2,lty=2) -->
<!-- lines(xF,lf.fore1$lower[,2],col=2,lwd=2,lty=2) -->
<!-- ## ARIMA(1,1,0) with drift -->
<!-- lines(x,fitted(mod2),col=3,lwd=2) -->
<!-- lines(xF,lf.fore2$mean,col=3,lwd=2) -->
<!-- lines(xF,lf.fore2$upper[,2],col=3,lwd=2,lty=2) -->
<!-- lines(xF,lf.fore2$lowe[,2],col=3,lwd=2,lty=2) -->
<!-- legend("bottomleft",c("GLM","RWD","ARIMA(1,1,0)+drift"),col=c(4,2,3),lwd=2,title = "Forecast:") -->
<!-- ``` -->
</section>
<section id="ts-vs-glm" class="slide level2">
<h2>TS vs GLM</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-9-1.png" width="960" class="r-stretch"></section>
<section id="forecasting-with-time-series-methods" class="slide level2">
<h2>Forecasting with time-series methods</h2>
<p>Advantages:</p>
<ul>
<li>much better goodness-of-fit</li>
<li>almost absent jump-off bias</li>
<li>wider prediction intervals</li>
</ul>
<p>What about summary measures? Can we try to incorporate uncertainty from <span class="math inline">\(m\)</span> different models together?</p>
</section>
<section id="arima-pis" class="slide level2">
<h2>ARIMA PIs</h2>
<ul>
<li>The computation of ARIMA prediciton intervals is rather complex (and beyond the scope of this course)</li>
<li>A simple example: if <span class="math inline">\(\hat{\sigma}\)</span> is the standard deviation of the residuals, then for any ARIMA model, the 95% PI for the first point forecast is given by <span class="math inline">\(\hat{y}_{T+1|T} \pm 1.96\hat{\sigma}\)</span></li>
<li>Advantage: in addition to theoretical PIs, we can simulate future paths of the time-series based on the estimated model</li>
</ul>
<p><span class="math inline">\(\Rightarrow\)</span> we can combine simulations from the different models in a bootstrapping framework</p>
</section>
<section id="exercise-2" class="slide level2">
<h2>Exercise</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<p>Consider again the best ARIMA model for the log-fertility time series seen before. Compare the analytical PIs derived earlier with those we could obtain from simulating future paths of the time series. Repeat this exercise for different number of simulations. When do the PIs between the two approaches get more similar?</p>
</div>
</div>
</div>
<p>Hint: use the function <code>simulate(object=., nsim=.,future=TRUE, bootstrap=TRUE)</code> to produce future paths of your estimated model</p>
</section>
<section id="one-possible-solution-2" class="slide level2 smaller">
<h2>One possible solution</h2>
<!-- ``` r -->
<!-- ## computing simulated future paths -->
<!-- ## number of simulations -->
<!-- nS <- 100    ## increase for improved precision -->
<!-- set.seed(1)  ## for reproducibility -->
<!-- ## object to store simulations -->
<!-- LFsim <- matrix(NA,h,nS) -->
<!-- for (s in 1:nS){ -->
<!--   lf.fore.sim <- simulate(mod2, nsim=h, -->
<!--                           future=TRUE, bootstrap=TRUE) -->
<!--   ## plotting one simulation -->
<!--   # plot(x,lf,ylim=range(lf,lf.fore.sim),xlim=range(tF)) -->
<!--   # lines(xF,lf.fore.sim) -->
<!--   ## saving -->
<!--   LFsim[,s] <- lf.fore.sim -->
<!-- } -->
<!-- ## plotting all simulations -->
<!-- plot(x,lf,ylim=range(lf,LFsim),xlim=range(tF)) -->
<!-- matlines(xF,LFsim,col="grey80",lty=1) -->
<!-- ## deriving median and 95% PI -->
<!-- lev <- 95; lev.p <- lev/100 -->
<!-- lf.fore.med <- apply(LFsim,1,median) -->
<!-- lf.fore.low <- apply(LFsim,1,quantile,prob=(1-lev.p)/2) -->
<!-- lf.fore.up <- apply(LFsim,1,quantile,prob=1-(1-lev.p)/2) -->
<!-- ## comparing PIs -->
<!-- plot(x,lf,ylim=range(lf,lf.fore2$lower,lf.fore.low),xlim=range(tF)) -->
<!-- ## analytical -->
<!-- lines(xF,lf.fore2$mean,col=3,lwd=2) -->
<!-- lines(xF,lf.fore2$upper[,2],col=3,lwd=2,lty=2) -->
<!-- lines(xF,lf.fore2$lower[,2],col=3,lwd=2,lty=2) -->
<!-- ## simulations -->
<!-- lines(xF,lf.fore.med,col=4,lwd=2) -->
<!-- lines(xF,lf.fore.up,col=4,lwd=2,lty=2) -->
<!-- lines(xF,lf.fore.low,col=4,lwd=2,lty=2) -->
<!-- legend("bottomleft",c("analytical","simulations"),col=c(3,4),lwd=2) -->
<!-- ``` -->
</section>
<section id="arima-simulations" class="slide level2">
<h2>ARIMA simulations</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch"></section>
<section id="arima-pis-1" class="slide level2">
<h2>ARIMA PIs</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-11-1.png" width="960" class="r-stretch"></section>
<section id="summary-measures" class="slide level2">
<h2>Summary measures</h2>
<p>Combining simulations from <span class="math inline">\(m\)</span> different models…</p>
</section>
<section id="arima-tfr-with-80-pi" class="slide level2">
<h2>ARIMA TFR with 80% PI</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-12-1.png" width="960" class="r-stretch"></section>
<section id="age-specific-fertility-pattern" class="slide level2">
<h2>Age-specific fertility pattern</h2>
<p>What about the age-specific shape of fertility?</p>
</section>
<section id="arima-age-pattern" class="slide level2">
<h2>ARIMA age-pattern</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-13-1.png" width="960" class="r-stretch"></section>
<section id="arima-age-pattern-1" class="slide level2">
<h2>ARIMA age-pattern</h2>

<img data-src="Lecture2_files/figure-revealjs/unnamed-chunk-14-1.png" width="960" class="r-stretch"></section>
<section id="forecasting-with-time-series-methods-1" class="slide level2">
<h2>Forecasting with time-series methods</h2>
<p>Advantages:</p>
<ul>
<li>much better goodness-of-fit</li>
<li>almost absent jump-off bias</li>
<li>larger prediction intervals</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>strange wiggling behaviour over ages</li>
<li>too large prediction intervals?</li>
</ul>
</section>
<section id="day-2-assignment" class="slide level2">
<h2>Day 2 assignment</h2>
<div style="font-size: 77%;">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Assignment</strong></p>
</div>
<div class="callout-content">
<ol start="3" type="1">
<li>Load the mortality data <code>MORTSWE.Rdata</code>, and focus on mortality from 1950 to 2000 for males aged 20 years. Fit and forecast mortality up to 2022 using two separate models:</li>
</ol>
<ul>
<li>a random walk with drift model for log-rates</li>
<li>the best possible ARIMA model for log-rates</li>
</ul>
<p>Plot the forecast rates against the subsequently observed data in 2001-2022. Which model seems to forecast mortality better?</p>
<ol start="4" type="1">
<li><p>Load the mortality data <code>MORTSWE.Rdata</code>, and focus on male mortality from 1950 onwards for those aged 0-100 (i.e.&nbsp;exclude the 101-110+ age groups). Fit and forecast mortality up to 2050 using the best possible ARIMA model for log-rates for all age groups available (a <code>for</code> loop is a convenient way to do so). Compare the observed age-pattern of mortality against the forecast one. Does it seem like a reasonable pattern of mortality? [Hint: you will need to replace minus infinite values of <span class="math inline">\(\ln (m_{x,t})\)</span> with <code>NA</code> for some age groups]</p></li>
<li><p>Following up on Exercise 4, compute simulations for the future paths of all <span class="math inline">\(\ln (m_{x,t})\)</span>, and combine them together to compute a forecast of life expectancy. Use the provided function <code>LifetableMX.R</code> to construct a life table from your (log) rates. [Hint: you will need to create an array, rather than a matrix, where to store your simulations of <span class="math inline">\(\ln (m_{x,t})\)</span>]</p></li>
</ol>
</div>
</div>
</div>
</div>
<div class="footer">

</div>
<!-- END -->
<!-- <https://quarto.org/docs/presentations/>. -->

<img src="images/edsd1.png" class="slide-logo r-stretch"><div class="footer footer-default">
<p>European Doctoral School of Demography 2023/2024 <span class="math inline">\(\cdot\)</span> INED, Aubervilliers</p>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="Lecture2_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="Lecture2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="Lecture2_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="Lecture2_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>